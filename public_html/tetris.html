<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div id="result"></div>
        <div id="tetris"></div>
    </body>
    <script>
        //objecte joc
        var joc = {
            mapa: [
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            ],
            estat: "",
            puntuacio: 0,
            puntMax: (localStorage.getItem("max" == undefined ? 0 : localStorage.getItem("max"))),

            pecaV: {},
            pecaS: {},
            cont: [0, 0, 0, 0, 0, 0, 0],
            intervalT: 0,
            inicializar: function () {
                var resultat = "<table border='1'>";
                for (var i = 0; i < this.mapa.length; i++)
                {
                    resultat = resultat + "<tr>";
                    for (var j = 0; j < this.mapa[i].length; j++)
                    {
                        resultat = resultat + "<td>";
                        if (this.mapa[i][j] == 1) {
                            resultat = resultat + "X";
                        } else {
                            resultat = resultat + "&nbsp;&nbsp;&nbsp;";
                        }
                        ;
                        resultat = resultat + "</td>";
                    }
                    resultat = resultat + "</tr>";
                }
                resultat = resultat + "</table>";
                document.getElementById("tetris").innerHTML = resultat;
            },
            pecaSAleatoria: function () {},
            interaccioTeclat: function () {},
            movAuto: function () {}

        };
        //__________________FUNCION QUE GENERA UNA PIEZA ALEATORIA, DEVUELVE UN ARRAY CON LA FORMA Y EL COLOR
        function GeneraPecaAleatoria()
        {
            var peces = [
                [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "groc"],
                [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0]], "lila"],
                [[[0, 0, 0, 0], [0, 1, 1, 0], [1, 1, 0, 0], [0, 0, 0, 0]], "verd"],
                [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 0, 1, 1], [0, 0, 0, 0]], "roig"],
                [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "blau"],
                [[[0, 1, 1, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "taronga"],
                [[[0, 0, 0, 0], [1, 1, 1, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "morat"]];
            var numeroAleatori = Math.round(Math.random() * 6);
            return peces[numeroAleatori];
        }
        // GeneraPecaAleatoria() devuelve array de 2 posiciones, pos 1 -> forma, pos 2 -> color
        var genPieza = GeneraPecaAleatoria();

        //____________________________________Objeto pieza________________________________________________
        var pieza = function (forma, color, x, y)
        {
            this.forma = forma;
            this.color = color;
            this.x = x;
            this.y = y;
        };
        //LA PIEZA SE CREARIA ASÍ----> 
        var p = new pieza(genPieza[0], genPieza[1], 0, 3);
        //console.log(p);

        //_________________________FUNCIONES DEL OBJETO PIEZA____________________________________________________
        //
        //__________________________FUNCION TEMPORAL PARA VER LA PIEZA EN PANTALLA
        pieza.prototype.pintar = function ()
        {
            for (var i = 0; i < this.forma.length; i++)
            {
                for (var j = 0; j < this.forma[i].length; j++)
                {
                    if (this.forma[i][j] == 1) {
                        joc.mapa[(this.x + i)][(this.y + j)] = 1;
                        joc.inicializar();
                    }
                }
            }
        };

        //______________FUNCION PARA ROTAR A LA DERECHA_________________________
        pieza.prototype.rotarDreta = function () {
            var formaNova = new Array();
            for (var i = 0; i < this.forma.length; i++) {
                formaNova[i] = new Array();
                for (var j = 0; j < this.forma[i].length; j++) {
                    formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                }
            }
            this.forma = formaNova;
        };

        //___________FUNCION PARA MOVER A LA IZQUIERDA
        pieza.prototype.moureEsq = function () {
            if ((this.x - 1) > 0) {
                this.x--;
            }
        };

        //_____________FUNCION PARA MOVER A LA DERECHA
        pieza.prototype.moureDreta = function () {
            if ((this.x + 1) < 14) {
                this.x++;
            }
        };

        //____________FUNCION PARA MOVER LA PIEZA HACIA ABAJO
        pieza.prototype.moureAvall = function () {
            if ((this.y - 1) >= 0) {
                //joc.mapa[(this.x)][(this.y)] = 0;
                this.x++;
            }
        };
        
        joc.inicializar();
        p.pintar();
        //p.moureDreta();
        //p.pintar();
        //document.getElementById("rotar").innerHTML = p.pintar();
        
        /*var a = setInterval(function () {
            p.moureAvall();
            p.pintar();
        }
        , 1000);*/
    </script>
</html>
